/**
 * videojs-vtt-thumbnails
 * @version 0.0.13-smashcut
 * @copyright 2020 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsVttThumbnails=t(e.videojs)}(this,function(o){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t={},r=Object.freeze({default:t}),s=r?t:r,n=void 0!==e?e:"undefined"!=typeof window?window:{},a="undefined"!=typeof document?document:n["__GLOBAL_DOCUMENT_CACHE@4"]||(n["__GLOBAL_DOCUMENT_CACHE@4"]=s);"function"==typeof Symbol&&Symbol.asyncIterator&&(u.prototype[Symbol.asyncIterator]=function(){return this}),u.prototype.next=function(e){return this._invoke("next",e)},u.prototype.throw=function(e){return this._invoke("throw",e)},u.prototype.return=function(e){return this._invoke("return",e)};function l(e){this.value=e}function u(o){var i,n;function a(e,t){try{var r=o[e](t),s=r.value;s instanceof l?Promise.resolve(s.value).then(function(e){a("next",e)},function(e){a("throw",e)}):u(r.done?"return":"normal",r.value)}catch(e){u("throw",e)}}function u(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?a(i.key,i.arg):n=null}this._invoke=function(s,o){return new Promise(function(e,t){var r={key:s,arg:o,resolve:e,reject:t,next:null};n?n=n.next=r:(i=n=r,a(s,o))})},"function"!=typeof o.return&&(this.return=void 0)}var h={},p={},d=o.registerPlugin||o.plugin,c=(f.prototype.src=function(e){this.resetPlugin(),this.options.src=e,this.initializeThumbnails()},f.prototype.detach=function(){this.resetPlugin()},f.prototype.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},f.prototype.listenForDurationChange=function(){this.player.on("durationchange",function(){})},f.prototype.initializeThumbnails=function(){var t=this;if(this.options.src){var e=this.getBaseUrl(),r=this.getFullyQualifiedUrl(this.options.src,e);this.getVttFile(r).then(function(e){t.vttData=t.processVtt(e),t.setupThumbnailElement()})}},f.prototype.getBaseUrl=function(){return[i.location.protocol,"//",i.location.hostname,i.location.port?":"+i.location.port:"",i.location.pathname].join("").split(/([^\/]*)$/gi).shift()},f.prototype.getVttFile=function(s){var o=this;return new Promise(function(e,t){var r=new i.XMLHttpRequest;r.data={resolve:e},r.addEventListener("load",o.vttFileLoaded),r.open("GET",s),r.send()})},f.prototype.vttFileLoaded=function(){this.data.resolve(this.responseText)},f.prototype.setupThumbnailElement=function(){var e=this,t=this.player.$(".vjs-mouse-display"),r=a.createElement("div");this.progressBar=this.player.$(".vjs-progress-control"),r.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar.appendChild(r),this.thumbnailHolder=r,t&&t.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=function(){return e.onBarMouseenter()},this.registeredEvents.progressBarMouseLeave=function(){return e.onBarMouseleave()},this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)},f.prototype.onBarMouseenter=function(){var t=this;this.mouseMoveCallback=function(e){t.onBarMousemove(e)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()},f.prototype.onBarMouseleave=function(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()},f.prototype.getXCoord=function(e,t){var r=e.getBoundingClientRect(),s=a.documentElement;return t-(r.left+(i.pageXOffset||s.scrollLeft||0))},f.prototype.onBarMousemove=function(e){this.updateThumbnailStyle(o.dom.getPointerPosition(this.progressBar,e).x,this.progressBar.offsetWidth)},f.prototype.getStyleForTime=function(e){for(var t=0;t<this.vttData.length;++t){var r=this.vttData[t];if(e>=r.start&&e<r.end){if(r.css.url&&!p[r.css.url]){var s=new i.Image;s.src=r.css.url,p[r.css.url]=s}return r.css}}},f.prototype.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},f.prototype.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},f.prototype.updateThumbnailStyle=function(e,t){var r=e*this.player.duration(),s=this.getStyleForTime(r);if(!s)return this.hideThumbnailHolder();var o=e*t,i=parseInt(s.width,10),n=i>>1,a=t-(o+n),u=o-n;if(0<u&&0<a?this.thumbnailHolder.style.transform="translateX("+(o-n)+"px)":u<=0?this.thumbnailHolder.style.transform="translateX(0px)":a<=0&&(this.thumbnailHolder.style.transform="translateX("+(t-i)+"px)"),!this.lastStyle||this.lastStyle!==s)for(var l in this.lastStyle=s)s.hasOwnProperty(l)&&(this.thumbnailHolder.style[l]=s[l])},f.prototype.processVtt=function(e){var a=this,u=[];return e.split(/[\r\n][\r\n]/i).forEach(function(e){if(e.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){var t=e.split(/[\r\n]/i),r=t[0].split(/ ?--> ?/i),s=r[0],o=r[1],i=t[1],n=a.getVttCss(i);u.push({start:a.getSecondsFromTimestamp(s),end:a.getSecondsFromTimestamp(o),css:n})}}),u},f.prototype.getFullyQualifiedUrl=function(e,t){return 0<=e.indexOf("//")?e:0===t.indexOf("//")?[t.replace(/\/$/gi,""),this.trim(e,"/")].join("/"):0<t.indexOf("//")?[this.trim(t,"/"),this.trim(e,"/")].join("/"):e},f.prototype.getPropsFromDef=function(e){var t=e.split(/#xywh=/i),r=t[0],s=t[1].match(/[0-9]+/gi);return{x:s[0],y:s[1],w:s[2],h:s[3],image:r}},f.prototype.getVttCss=function(e){var t={},r=void 0;if(r=0<=this.options.src.indexOf("//")?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(e=this.getFullyQualifiedUrl(e,r)).match(/#xywh=/i))return t.background='url("'+e+'")',t;var s=this.getPropsFromDef(e);return t.background='url("'+s.image+'") no-repeat -'+s.x+"px -"+s.y+"px",t.width=s.w+"px",t.height=s.h+"px",t.url=s.image,t},f.prototype.doconstructTimestamp=function(e){var t=e.split("."),r=t[0].split(":");return{milliseconds:parseInt(t[1],10)||0,seconds:parseInt(r.pop(),10)||0,minutes:parseInt(r.pop(),10)||0,hours:parseInt(r.pop(),10)||0}},f.prototype.getSecondsFromTimestamp=function(e){var t=this.doconstructTimestamp(e);return parseInt(3600*t.hours+60*t.minutes+t.seconds+t.milliseconds/1e3,10)},f.prototype.trim=function(e,t){var r=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),s=0,o=0;for(e+="",t&&(r=(t+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),s=e.length,o=0;o<s;o++)if(-1===r.indexOf(e.charAt(o))){e=e.substring(o);break}for(o=(s=e.length)-1;0<=o;o--)if(-1===r.indexOf(e.charAt(o))){e=e.substring(0,o+1);break}return-1===r.indexOf(e.charAt(0))?e:""},f);function f(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.player=e,this.options=t,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}function v(r){var s=this;this.ready(function(){var e,t;e=s,t=o.mergeOptions(h,r),e.addClass("vjs-vtt-thumbnails"),e.vttThumbnails=new c(e,t)})}return d("vttThumbnails",v),v.VERSION="0.0.13-smashcut",v});