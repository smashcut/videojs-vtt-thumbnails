/**
 * videojs-vtt-thumbnails
 * @version 0.0.13-smashcut
 * @copyright 2020 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsVttThumbnails=e(t.videojs)}(this,function(i){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e={},r=Object.freeze({default:e}),s=r?e:r,n=void 0!==t?t:"undefined"!=typeof window?window:{},a="undefined"!=typeof document?document:n["__GLOBAL_DOCUMENT_CACHE@4"]||(n["__GLOBAL_DOCUMENT_CACHE@4"]=s);"function"==typeof Symbol&&Symbol.asyncIterator&&(u.prototype[Symbol.asyncIterator]=function(){return this}),u.prototype.next=function(t){return this._invoke("next",t)},u.prototype.throw=function(t){return this._invoke("throw",t)},u.prototype.return=function(t){return this._invoke("return",t)};function l(t){this.value=t}function u(i){var o,n;function a(t,e){try{var r=i[t](e),s=r.value;s instanceof l?Promise.resolve(s.value).then(function(t){a("next",t)},function(t){a("throw",t)}):u(r.done?"return":"normal",r.value)}catch(t){u("throw",t)}}function u(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?a(o.key,o.arg):n=null}this._invoke=function(s,i){return new Promise(function(t,e){var r={key:s,arg:i,resolve:t,reject:e,next:null};n?n=n.next=r:(o=n=r,a(s,i))})},"function"!=typeof i.return&&(this.return=void 0)}var h={},p={},d=i.registerPlugin||i.plugin,f=(c.prototype.src=function(t){this.resetPlugin(),this.options.src=t,this.initializeThumbnails()},c.prototype.detach=function(){this.resetPlugin()},c.prototype.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},c.prototype.listenForDurationChange=function(){this.player.on("durationchange",function(){})},c.prototype.initializeThumbnails=function(){var e=this;if(this.options.src){var t=this.getBaseUrl(),r=this.getFullyQualifiedUrl(this.options.src,t);this.getVttFile(r).then(function(t){e.vttData=e.processVtt(t),e.setupThumbnailElement()})}},c.prototype.getBaseUrl=function(){return[o.location.protocol,"//",o.location.hostname,o.location.port?":"+o.location.port:"",o.location.pathname].join("").split(/([^\/]*)$/gi).shift()},c.prototype.getVttFile=function(s){var i=this;return new Promise(function(t,e){var r=new o.XMLHttpRequest;r.data={resolve:t},r.addEventListener("load",i.vttFileLoaded),r.open("GET",s),r.send()})},c.prototype.vttFileLoaded=function(){this.data.resolve(this.responseText)},c.prototype.setupThumbnailElement=function(){var t=this,e=this.player.$(".vjs-mouse-display"),r=a.createElement("div"),s=a.createElement("div"),i=a.createElement("div");r.setAttribute("class","vjs-vtt-thumbnail-display"),s.setAttribute("class","vjs-vtt-thumbnail-arrow"),i.setAttribute("class","vjs-vtt-thumbnail-time"),r.appendChild(s),r.appendChild(i),this.thumbnailHolder=r,this.arrow=s,this.time=i,this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(r),e&&e.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=function(){return t.onBarMouseenter()},this.registeredEvents.progressBarMouseLeave=function(){return t.onBarMouseleave()},this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)},c.prototype.onBarMouseenter=function(){var e=this;this.mouseMoveCallback=function(t){e.onBarMousemove(t)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()},c.prototype.onBarMouseleave=function(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()},c.prototype.getXCoord=function(t,e){var r=t.getBoundingClientRect(),s=a.documentElement;return e-(r.left+(o.pageXOffset||s.scrollLeft||0))},c.prototype.onBarMousemove=function(t){this.updateThumbnailStyle(i.dom.getPointerPosition(this.progressBar,t).x,this.progressBar.offsetWidth)},c.prototype.getStyleForTime=function(t){for(var e=0;e<this.vttData.length;++e){var r=this.vttData[e];if(t>=r.start&&t<r.end){if(r.css.url&&!p[r.css.url]){var s=new o.Image;s.src=r.css.url,p[r.css.url]=s}return r.css}}return this.vttData[0]},c.prototype.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},c.prototype.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},c.prototype.formatTime=function(t){function e(t){return t<10?"0"+t:""+t}var r=Math.round(t%60),s=Math.floor(t/60)%60,i=Math.floor(t/3600);return 0<i?e(i)+":"+e(s)+":"+e(r):e(s)+":"+e(r)},c.prototype.updateThumbnailStyle=function(t,e){var r=t*this.player.duration(),s=this.getStyleForTime(r);if(!s)return this.hideThumbnailHolder();this.time.innerHTML=this.formatTime(r);var i=t*e,o=parseInt(s.width,10),n=o>>1,a=e-(i+n),u=i-n;if(0<u&&0<a?(this.thumbnailHolder.style.transform="translateX("+(i-n)+"px)",this.arrow.style.removeProperty("left")):u<=0?(this.thumbnailHolder.style.transform="translateX(0px)",this.arrow.style.left=i+"px"):a<=0&&(this.thumbnailHolder.style.transform="translateX("+(e-o)+"px)",this.arrow.style.left=i-e+o+"px"),!this.lastStyle||this.lastStyle!==s)for(var l in this.lastStyle=s)s.hasOwnProperty(l)&&(this.thumbnailHolder.style[l]=s[l])},c.prototype.processVtt=function(t){var a=this,u=[];return t.split(/[\r\n][\r\n]/i).forEach(function(t){if(t.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){var e=t.split(/[\r\n]/i),r=e[0].split(/ ?--> ?/i),s=r[0],i=r[1],o=e[1],n=a.getVttCss(o);u.push({start:a.getSecondsFromTimestamp(s),end:a.getSecondsFromTimestamp(i),css:n})}}),u},c.prototype.getFullyQualifiedUrl=function(t,e){return 0<=t.indexOf("//")?t:0===e.indexOf("//")?[e.replace(/\/$/gi,""),this.trim(t,"/")].join("/"):0<e.indexOf("//")?[this.trim(e,"/"),this.trim(t,"/")].join("/"):t},c.prototype.getPropsFromDef=function(t){var e=t.split(/#xywh=/i),r=e[0],s=e[1].match(/[0-9]+/gi);return{x:s[0],y:s[1],w:s[2],h:s[3],image:r}},c.prototype.getVttCss=function(t){var e={},r=void 0;if(r=0<=this.options.src.indexOf("//")?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(t=this.getFullyQualifiedUrl(t,r)).match(/#xywh=/i))return e.background='url("'+t+'")',e;var s=this.getPropsFromDef(t);return e.background='url("'+s.image+'") no-repeat -'+s.x+"px -"+s.y+"px",e.width=s.w+"px",e.height=s.h+"px",e.url=s.image,e},c.prototype.doConstructTimestamp=function(t){var e=t.split("."),r=e[0].split(":");return{milliseconds:parseInt(e[1],10)||0,seconds:parseInt(r.pop(),10)||0,minutes:parseInt(r.pop(),10)||0,hours:parseInt(r.pop(),10)||0}},c.prototype.getSecondsFromTimestamp=function(t){var e=this.doConstructTimestamp(t);return parseInt(3600*e.hours+60*e.minutes+e.seconds+e.milliseconds/1e3,10)},c.prototype.trim=function(t,e){var r=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),s=0,i=0;for(t+="",e&&(r=(e+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),s=t.length,i=0;i<s;i++)if(-1===r.indexOf(t.charAt(i))){t=t.substring(i);break}for(i=(s=t.length)-1;0<=i;i--)if(-1===r.indexOf(t.charAt(i))){t=t.substring(0,i+1);break}return-1===r.indexOf(t.charAt(0))?t:""},c);function c(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.player=t,this.options=e,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}function v(r){var s=this;this.ready(function(){var t,e;t=s,e=i.mergeOptions(h,r),t.addClass("vjs-vtt-thumbnails"),t.vttThumbnails=new f(t,e)})}return d("vttThumbnails",v),v.VERSION="0.0.13-smashcut",v});